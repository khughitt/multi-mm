---
title: Multiple Myeloma Dataset Comparison
author: V. Keith Hughitt
date: "`r format(Sys.time(), '%d %B, %Y') `"
output:
  html_document:
    toc: true
    number_sections: true
---

<!--

TODO: July 24, 2019

- Add <collection> prefix to gene set entries to account for keys (e.g. drug names)
   that appear in multiple collections
- Use individual MSigDB gmt files instead of combined one for easier comparison

TODO: July 23, 2019

- Dataset thumbnails
  - Using an even smaller subset of genes
  - Build mini heatmaps for each dataset, with genes / order fixed.
-->

# Setup

```{r settings}
# analysis version
VERSION <- '2019-07-22'

# maximum ratio of covariate variables to allow before exluding a gene
# from the final score computation
GENE_MAX_MISSING_COVARIATES <- 0.8

# minimum number of genes required for gene set to be included in analysis
GENE_SET_MIN_SIZE <- 5

# minimum p-value to allow for -log10 score computation
MIN_PVAL <- 1E-10

# function to use when aggregating data along pathways
PATHWAY_AGG_FUNC <- 'mean'

# maximum number of threads to use
MAX_THREADS <- 12

# fgsea parameters
FGSEA_NPERM <- 15000
```

```{r child='rmd/setup.Rmd'}
```

```{r rmarkdown_settings, include = FALSE}
# stop on encountered an error in a child rmd file
opts_chunk$set(error = FALSE)
opts_knit$set(verbose = TRUE)
```

# Overview

Summary of datasets included in this analysis:

```{r child='rmd/dataset_summary.Rmd'}
```

# Methods

```{r child='rmd/load_gene_sets.Rmd'}
```

```{r child='rmd/load_geo.Rmd'}
```

```{r child='rmd/load_mmrf.Rmd'}
```

```{r child='rmd/combine_gene_weights.Rmd'}
```

```{r child='rmd/combine_pathway_weights.Rmd'}
```

# Results

```{r child='rmd/results_overview.Rmd'}
```

```{r child='rmd/results_dataset_similarity.Rmd'}
```

```{r child='rmd/results_functional_enrichment.Rmd'}
```

```{r child='rmd/results_gene_scores.Rmd'}
```

# System information

```{r, collapse=FALSE}
sessionInfo()
```

```{r git_commit}
system('git rev-parse --short HEAD', intern = TRUE)
```

```{r save_html, include=FALSE}
system(sprintf('(sleep 15 && cp README.html %s) &', output_dir))
```

